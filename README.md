# wfb-ng-openwrt

WFB-NG for OpenWrt uses the special mechanic of "aggregation" from wfb_ng to bring together data streams from many "forwarders" for data multiversity over an extended LAN, using both physical ethernet cables and 2,4ghz as backhaul channel.

## Explanations & descriptions
Forwarder: an instance of wfb_rx running in forwarding mode, it simply forwards the encrypted stream to an aggregator to decrypt and distribute to a reciever.
example code

Aggregator: an instance of wfb_rx running in aggregation mode, which takes one or many udp streams of encrypted data from wfb_rx instances running in forward mode.
example code

## Standard features
USB-tethering to Android devices (Android TV, Android Phones, Android tablets, Meta Quest2/3). Requires sideloading PixelPilot (https://github.com/OpenIPC/PixelPilot)

UDP videostream to port 5600 by default

Set up master (aggregator) and slave (forwarder) nodes, only limited by the bandwidth availailable on your OpenWRT network.

## Non-standard features
You can configure and setup any applications on your OpenWRT devices and change the behaviour of routing and aggregator/forward setup depending on your needs and requirements.
It is possible to augment either a local instance of wfb_ng on your Radxa or other x86 groundstation with forwarded data streams, or act as a forwarded and feed the stream from your groundstation to a joint aggregation network.

## Limitations
At the moment, wfb_ng have some limitations with parsing wifi6/7 packages. There are some development ongoing and ways around it but not in mainline wfb_ng version, so avoid for now. Stick to known and tested devices if you do not wish to experiement.

## Tested devices
In theory any WiFi4 router with 5GHz network should work 

(WiFi4) Wifi Google (https://openwrt.org/toh/google/wifi)

(WiFi4) TP-link CPE510  (https://openwrt.org/toh/tp-link/cpe510)

## Devices currently being tested / investigated for compatibility
(WiFi6) https://openwrt.org/toh/asus/rt-ax53u

## Setup process
① Make sure the router is a WiFi5 router. Currently tested WiFi6 routers do not support it [wifi 5 routers support 802.11 a/b/g/n/ac protocols. If the router also supports ax and be protocols, it is not a WiFi5 router]
② Make sure the router can be flashed with openwrt [check TOH https://openwrt.org/toh/start]
③ Flash the router to the openwrt system [click from the TOH page to enter the device's Wiki page]
④ Compile and generate router firmware with wfb-ng [Can I install the ipk package directly? ]
⑤ Update the router firmware to the firmware containing wfb-ng [system-Flash Firmware]

## Use SDK to compile and generate ipk installation package
• Download SDK and unzip [https://downloads.openwrt.org/releases/23.05.4/targets/ath79/generic/openwrt-sdk-23.05.4-ath79-generic_gcc-12.3.0_musl.Linux-x86_64.tar.xz]

• Modify feeds.conf.default, add wfb-ng-openwrt source at the end, 94402133c3b7216188785a0b36f9a75e2c1b4e54 is the commit id corresponding to the source code

○ echo "https://github.com/OpenIPC/wfb-ng-openwrt.git^94402133c3b7216188785a0b36f9a75e2c1b4e54" >>使用SDK编译生成ipk安装包

• 下载sdk并解压【https://downloads.openwrt.org/releases/23.05.4/targets/ath79/generic/openwrt-sdk-23.05.4-ath79-generic_gcc-12.3.0_musl.Linux-x86_64.tar.xz】

• 修改feeds.conf.default, 在末尾追加wfb-ng-openwrt源，94402133c3b7216188785a0b36f9a75e2c1b4e54是源码对应的提交id

○ echo "https://github.com/OpenIPC/wfb-ng-openwrt.git^94402133c3b7216188785a0b36f9a75e2c1b4e54" >> feeds.conf.default

• Update and install feeds

○ ./scripts/feeds update -a

○ ./scripts/feeds install -a

○ Tips: If you encounter has a dependency on, execute the above command again

• Compile wfb-ng

○ make package/wfb-ng/compile[directly select save->ok->exit in the pop-up menuconfig]

• View the installation package generated by the compilation

○ ls bin/packages/*/wfbng/

Compile router firmware
• Download imagebuilder and unzip [https://downloads.openwrt.org/releases/23.05.4/targets/ath79/generic/openwrt-imagebuilder-23.05.4-ath79-generic.Linux-x86_64.tar.xz]
• Copy the wfb-related ipk installation package to the packages directory
• make info to view the name of the router configuration file
• make image PROFILE=google_wifi PACKAGES="wfb-gs kmod-usb-net-rndis" If the router does not have a USB port or does not need USB streaming, there is no need to install kmod-usb-net-rndis. As a receiver, wfb-keygen\tx\tx-cmd is optional.

Some other useful software packages
lrzsz usbutils fdisk exfat-mkfs exfat-fsck kmod-fs-exfat kmod-fs-vfat dosfstools ip-full ifstat tcpdump socat


## Link list for technical people
https://github.com/svpcom/wfb-ng/wiki/wfb_tx-and-wfb_rx-reference

## Joakim special distributed LAN configuration
![image](https://github.com/user-attachments/assets/f8e70d06-f2d6-40ee-82a8-cd3969b59b5f)


## Todo
A section on how to build your own wfb_ng packages

A section on how to build your own flashable image

Create a flow chart of instances, ports and setup on typical use case with 2-4 wfb-ngopenwrt devicees and integrate with a groundstation.

Insert some pictures of working use cases (living room Android TV, Groundstation etc)
